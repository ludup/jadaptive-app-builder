<!DOCTYPE html>
<html lang="en" xmlns:jad="https://jadaptive.com/jadaptive">
<body>
<div class="col-12">
	<p class="alert alert-info"><i class="far fa-info"></i> <span jad:bundle="setupTenant" jad:i18n="configureSubDomain.summary"></span></p>
</div>
<div id="feedback" class="col-12"></div>
<div class="row" id="content">
	<div class="ms-3">
	<form action="/app/api/form/setupTenant/configureSubDomain">
			
			<div class="col-md-12 mb-3">
			   <label for="subdomain" class="form-label" jad:bundle="setupTenant" jad:i18n="subdomain.name"></label>
	           <div class="input-group">
				  <input type="text" id="subdomain" name="subdomain" class="form-control" aria-describedby="basic-addon2">
				  <span class="input-group-text" id="basic-addon2">.<span id="domain">domain.name</span></span>
				</div>
	           <small class="form-text text-muted" jad:bundle="setupTenant" jad:i18n="subdomain.desc"></small>
			</div>
			
		</form>
	</div>
</div>
<div>
<script type="text/javascript">

 $(function() {
	 Wizard.initStep('setupTenant', function(success, cancel) {
		  
		 var domain = $('#subdomain').val() + '.' + $('#domain').text();
		 $.getJSON("/app/api/tenant/validate/" + domain + '/', function(data) {
				
				if(data.success && data.resource) {
					$.ajax({
				           type: "POST",
				           url: $('form').attr('action'),
				           cache: false,
				           contentType: false,
				    	   processData: false,
				           data: new FormData($("form")[0]),
				           dataType: 'json',
				           success: function(data)
				           {
				           	   	if(data.success) {
				           			success();
				           	   	} else {
				           	    	JadaptiveUtils.error($('#feedback'), data.message);
				           	   	}
				           },
				           complete: function() {
								cancel();
				           }
				      });
				} else {
					JadaptiveUtils.error($('#feedback'), "The domain " + domain + " is already taken.");
				}
		 });
	 });
 });
</script>
</div>

</body>
</html>